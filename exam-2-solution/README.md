# Систем за Управување со Настани

### Забелешка:
Сите функционалности треба да бидат имплементирани како API endpoints. Нема потреба од пишување HTML код!

> **НАПОМЕНА:**  
> Потребно е да го симнете zip-от со starter code поставен на курсот и да продолжите со решавање во тој фолдер. Направете екстракција на zip фајлот со употреба на 7zip -> `Extract Here` ИСКЛУЧИВО! Задолжително тестирајте ја апликацијата прво пред да ја прикачите со десен клик (притоа изберете `run`) на `FeatureTest.php`, кој се наоѓа на патеката `tests/Feature/FeatureTest.php`. На крајот прикачувате `.zip` фајл од вашиот проект именуван како **ИмеПрезиме_индекс.zip**.

---

## Опис на системот
Системот овозможува корисниците да прегледуваат информации за настани и да прават резервации за одреден настан.  
Имињата на моделите и полињата во базата мора да бидат точни според дефиницијата за да може автоматските тестови да функционираат правилно.

---

## Модели и Табели во Базата

### Табела: `events`
Полиња:
- **id**
- **name**
- **slug** (автоматски генерирано, URL-friendly вредност базирана на `name`, не се менува по креирањето)
- **description**
- **location**
- **event_date**
- **capacity**
- **created_at**
- **updated_at**

### Табела: `reservations`
Полиња:
- **id**
- **event_id**
- **user_name**
- **ticket_quantity**
- **status** (можни вредности: `pending`, `confirmed`, `cancelled`)
- **created_at**
- **updated_at**

---

## Функционалности

### За Настани

#### Операции за Управување
1. **Листање**  
   - Листање на сите настани со можност за пребарување според `name` или `location`.  
   - Параметар за пребарување: `search` (преклопување со `name` или `location`).
   - При листање, да се прикажат:  
     `name`, `slug`, `location`, `event_date`, `capacity`.
   - Имплементирајте пагинација.

2. **Додавање**  
   - Креирање нов настан.  
   - Сите полиња (`name`, `description`, `location`, `event_date`, `capacity`) се задолжителни и подложни на валидација.

3. **Ажурирање**  
   - Уредување на информации за постоечки настан.  
   - Сите полиња се задолжителни и мора да поминат валидација.

4. **Бришење**  
   - Настан може да се избрише само ако нема потврдени резервации (`confirmed`).  
   - Доколку постојат потврдени резервации, бришењето е забрането.  
   - Користете `abort_if` за забрана.  
   - Статус на враќање: `400`.

5. **Приказ на еден настан**  
   - При приказ да се прикажат:  
     `name`, `slug`, `location`, `event_date`, `capacity`, `reservations` (сите резервации).

#### Валидација
- Полето `event_date` мора да биде датум во иднината.
- Полето `capacity` мора да биде позитивен цел број.

---

### За Резервации

#### Операции
1. **Креирање**  
   - Корисникот може да резервира билети за одреден настан под услов `ticket_quantity` да не го надминува достапниот капацитет (`capacity`).  
   - При креирање, статусот автоматски се поставува на `pending`.

2. **Потврда**  
   - Промена на статусот на резервација во `confirmed` или `cancelled`.  
   - **Потврда:**  
     - Резервацијата може да биде `confirmed` само ако претходно била `pending`.  
     - Користете `abort_if` за забрана.  
     - Статус на враќање: `400`.  
     - При `confirmed`, достапниот капацитет (`capacity`) се намалува за `ticket_quantity`.  
     - Користете класа за акција: `ConfirmReservationAction`.  
   - **Откажување:**  
     - Резервацијата може да биде `cancelled` само ако претходно била `confirmed`.  
     - Користете `abort_if` за забрана.  
     - Статус на враќање: `400`.  
     - При `cancelled`, достапниот капацитет (`capacity`) се зголемува за `ticket_quantity`.  
     - Користете класа за акција: `CancelReservationAction`.

#### Валидација
- Полето `event_id` мора да укажува на постоечки настан.
- Полето `ticket_quantity` мора да биде позитивен цел број и да не го надминува достапниот капацитет.
- Полето `user_name` е задолжително.

---

## Ендпоинти

### За Настани
- **GET** `/events`  
- **POST** `/events`  
- **GET** `/events/{event}`  
- **PUT** `/events/{event}`  
- **DELETE** `/events/{event}`  

### За Резервации
- **POST** `/reservations`  
- **PUT** `/reservations/{reservation}/confirm`  
- **PUT** `/reservations/{reservation}/cancel`
